<!DOCTYPE html>
<html>
  <head>
    <title>Gingshow Test Room</title>
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <style>
      #tray {
        position:fixed;top:0;left:0;width:100%;height:auto;
        transition:transform .35s cubic-bezier(0.165, 0.84, 0.44, 1);
        transform:translateY(0);
        font-size:16px;
        backdrop-filter: blur(10px);
        color:white;
        background-color:gray; padding:10px;
        display:flex;
        z-index:1;
      }
      #tray > div {
        font-size:11px;
        margin-left:15px;
      }
      #tray.collapsed {
          transform:translateY(-100%);
      }
      #hamburger {
        position:fixed;top:0;right:30px;width:30px; height:30px;
        background-color:#00FF00;
        cursor:pointer;
        z-index:2;
      }
      #hamburger.admin-connected {
        background-color:#FF0000;
      }
      #hamburger.admin-connected.you-are-admin {
        background-color:#AF4400;
      }
    </style>
    <link href="css/impress.css" rel="stylesheet" type="text/css">
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div id="tray" class="collapsed">
        <form id="form">
            <label>host (password):<input type="password" id="admin-password"></input></label>
            <button type="submit">Become Host</button>
        </form>
        <div id="admin-is"></div>
          <div id="you-are"></div>
    </div>
    <div id="hamburger" style="display:none" onclick="toggleTray()"></div>
    <div id="attempting-connection">Attempting connection...</div>
    <div id="application" class="container" style="display:none">

        <div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
    </div>

    <div id="impress" data-transition-duration="0">

      <div class="step"><p>Title slide</p>
    </div>
    <div class="step"><p class="song"><br>This <ch n="c"><c>7+11</c>izing ve<br>That swace<br>That wll</span><br>This iingve<br>Th awu <ch n="C"><c>11</c>e my wrw<br>That w will<br></p></div>
    <div class="step"><p class="song"> sis sis s DJs sms d<br>Sjsjdkdjd dkskss skims<br>Sjsjdkkds<br>Sndjdjdjd<br>Xjxjjdkdj<ch n="c"><c>7+11</c>dkdd dks did did sksms</p>
    </div>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/impress.js"></script>

    <script>
        var socket = io();
        var form = document.getElementById('form');
        var input = document.getElementById('admin-password');
        var yourId = "";
        var adminId = null;

        var trayShown = false;
        var tray =  document.getElementById('tray');
        function toggleTray() {
          trayShown = !trayShown;
          if (trayShown) {
            tray.classList.add("collapsed");
          } else {
            tray.classList.remove("collapsed");
          }
        }

        form.addEventListener('submit', function(e) {
          e.preventDefault();
          if (input.value) {
            socket.emit('admin-password-entry', input.value);
            input.value = '';
          }
        });

        var imp =  impress();
        var defaultNext = imp.next;
        var defaultPrev = imp.prev;
        var emptyFunc = function() {};
        function disableImp() {
          imp.next = emptyFunc;
          imp.prev = emptyFunc;
        }
        function enableImp() {
          imp.next = defaultNext;
          imp.prev = defaultPrev;
        }

        var rootElement = document.getElementById("impress");
        socket.on('joinedTestRoom', function(msg) {
            if (msg === yourId) {
              document.getElementById('application').style.display = "block";
              document.getElementById('attempting-connection').style.display = "none";
              document.getElementById('hamburger').style.display = "block";
              imp.init();
            } else {
              // someone else joined room
            }
        });
        document.getElementById("application").style.touchAction = "none";
        socket.on('hosted', function(msg) {

          if (msg) {
            adminId = msg;
            document.getElementById('hamburger').classList.add("admin-connected");
            document.getElementById('admin-is').innerHTML = "<i>Admin:</i> " + msg;

            if (adminId === yourId ) {
              document.getElementById('hamburger').classList.add("you-are-admin");
              form.style.visibility = "hidden";
              enableImp();
            }  else {
              document.getElementById('hamburger').classList.remove("you-are-admin");
              form.style.visibility = "visible";
              disableImp();
            }
          } else {
            enableImp();
            adminId = null;
            document.getElementById('admin-is').innerHTML = "";
            form.style.visibility = "visible";
            document.getElementById('hamburger').classList.remove("you-are-admin");
            document.getElementById('hamburger').classList.remove("admin-connected");
          }
        });

        socket.on('slideChange', function(msg) {
            var val = parseInt(msg);

            if (!isNaN(val)) imp.goto(val);
            else imp.goto(msg);
        });

        rootElement.addEventListener( "impress:stepenter", function(event) {

          socket.emit('slide-change', event.target.id);
        });

        socket.on('connect', function() {
            yourId = socket.id;
            document.getElementById('you-are').innerHTML = "<i>Your id:</i> " + socket.id;
            socket.emit('join-test-room', socket.sessionid);
        });

      </script>
  </body>
</html>
